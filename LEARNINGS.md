# Learnings

Auto-generated by nightly compound review. Read by Claude Code at session start.

## 2026-01-30

### Gotchas
- Supabase Security Advisor warnings must be addressed promptly — LLM-generated code often has RLS gaps
- Google Search Console "page with redirect" issues need redirect chain cleanup for proper indexing

## 2026-02-02

### Patterns
- Voice note limits split into short (<2min) and full (>2min) categories to enable generous free-tier micro-reflections while gating expensive long transcriptions behind Pro
- Email template functions must be registered in the sender's template map — having the React component alone isn't enough
- Feature flags in subscription config (structured_reflection, communication_analysis, etc.) give fine-grained tier control without code changes

### Gotchas
- Onboarding email cron failed with "Unknown template" because social-proof, first-value, feature-highlight, and last-chance components existed but weren't wired into the email sender's dispatch map
- `cannot change return type of existing function` in Supabase — must DROP and recreate the function rather than ALTER when return type changes
- Admin console had broken joins and N+1 queries that only surfaced under real data — test admin pages with populated databases

### Decisions
- Three-tier pricing (Free / Pro / Pro Plus) with voice notes as the key differentiator between tiers
- Short voice notes (under 2 min) unlimited on Pro, full session recordings (60-90 min) on Pro Plus only due to transcription costs
- Voice analysis for coaching quality (communication patterns, development blocks, CPD export) positioned as Pro Plus features
- New feature branch created to protect current user testing while building voice analysis features

## 2026-02-03

### Patterns
- Mobile scroll jank fix: use a single scroll container (h-[100dvh] flex-col overflow-hidden) with header/nav as shrink-0 overlays — never nest competing scrollable regions
- Consistent AI markdown formatting requires explicit system prompt instructions enforcing bold headings and bullet lists as a minimum baseline
- Visual warmth in AI chat: warm colour palette (amber/stone accents), emoji selectors, and trailing question prompts make the experience feel less robotic

### Gotchas
- Trailing AI questions ("Would you like me to continue?") blend into the answer body — visually separating them with a divider and accent styling makes the next step obvious
- Chat input padding on mobile wastes significant screen real estate — compact single-row textarea with tighter padding reclaims usable space

## 2026-02-04

### Patterns
- Capacitor 8 uses Swift Package Manager (SPM) instead of CocoaPods — Codemagic build scripts must skip workspace/pod steps and build the .xcodeproj directly
- RevenueCat setup requires three layers: entitlements (access level), products (App Store/Play Store items), and offerings (what users see) — configure entitlements first, then products, then wire into offerings
- Chunked transcription for large audio files: split recordings into segments to stay within API limits for 90+ minute coaching session recordings
- Mobile app submission checklist: delete-account URL, privacy policy URL, data safety declarations, and subscription descriptions must all be live before store review

### Gotchas
- iOS bundle ID mismatch between Capacitor config and Codemagic signing causes build failures — hardcode the bundle ID in both places and verify they match
- Codemagic auto-increment build number must be configured explicitly — iOS rejects duplicate build numbers on resubmission
- Google Play requires a service account credentials JSON for RevenueCat server-side receipt validation — this is separate from the Play Console login
- App Store "404 on URL" rejection: the delete-account and privacy policy pages must be deployed and publicly accessible before submission, not just committed to the repo

### Decisions
- CoachReflection mobile apps set up via Capacitor + Codemagic + RevenueCat — same stack as FootballGPT for consistency
- Four email parity features added to match FootballGPT standard: abandoned checkout recovery, streak-at-risk reminder, winback day-7 final email, Resend webhook tracking
- Pro and Pro Plus subscriptions configured in RevenueCat with matching entitlements for cross-platform subscription management

# Learnings

Auto-generated by nightly compound review. Read by Claude Code at session start.

## 2026-01-30

### Gotchas
- Supabase Security Advisor warnings must be addressed promptly — LLM-generated code often has RLS gaps
- Google Search Console "page with redirect" issues need redirect chain cleanup for proper indexing

## 2026-02-02

### Patterns
- Voice note limits split into short (<2min) and full (>2min) categories to enable generous free-tier micro-reflections while gating expensive long transcriptions behind Pro
- Email template functions must be registered in the sender's template map — having the React component alone isn't enough
- Feature flags in subscription config (structured_reflection, communication_analysis, etc.) give fine-grained tier control without code changes

### Gotchas
- Onboarding email cron failed with "Unknown template" because social-proof, first-value, feature-highlight, and last-chance components existed but weren't wired into the email sender's dispatch map
- `cannot change return type of existing function` in Supabase — must DROP and recreate the function rather than ALTER when return type changes
- Admin console had broken joins and N+1 queries that only surfaced under real data — test admin pages with populated databases

### Decisions
- Three-tier pricing (Free / Pro / Pro Plus) with voice notes as the key differentiator between tiers
- Short voice notes (under 2 min) unlimited on Pro, full session recordings (60-90 min) on Pro Plus only due to transcription costs
- Voice analysis for coaching quality (communication patterns, development blocks, CPD export) positioned as Pro Plus features
- New feature branch created to protect current user testing while building voice analysis features
